<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta
      charset="UTF-8"
      name="viewport"
      content="width=device-width, initial-scale=1.0, interactive-widget=resizes-content"
    />
    <title>schemius</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery.terminal@2.39.3/js/jquery.terminal.min.js"></script>
    <script src="./schemius.utils.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/jquery.terminal@2.39.3/css/jquery.terminal.min.css"
    />
    <style>
      @import url("https://cdn.jsdelivr.net/npm/@xz/fonts@1/serve/cascadia-code.css");
      @import url("https://cdn.jsdelivr.net/npm/source-code-pro@2.38.0/source-code-pro.min.css");
      @import url("https://cdn.jsdelivr.net/npm/firacode@6.2.0/distr/fira_code.min.css");
      @import url("https://cdn.jsdelivr.net/npm/jetbrains-mono@1.0.6/css/jetbrains-mono.min.css");

      .terminal {
        --size: 1.3;
      }

      .terminal-mobile {
        --size: 0.5;
      }
    </style>
  </head>
  <body>
    <script type="module">
      import init, { evaluate } from "./pkg/schemius_web.js";

      [
        "compositionstart",
        "compositionupdate",
        "compositionend",
        "input",
      ].forEach((event) => {
        window.addEventListener(
          event,
          (e) => {
            console.log(event, e);
          },
          true
        );
      });

      init().then(() => {
        setFont(defaultFont);
        setTheme(defaultTheme);

        $("body").terminal(
          function (expression) {
            expression = expression.replace(/\r?\n|\r/g, " ").trim();
            if (expression) {
              try {
                this.echo(evaluate(expression));
              } catch (e) {
                console.log(e);
                this.echo("Ooops... Something went wrong! :(");
                this.read("Press [Enter] to reload\n\t").then(() => {
                  location.reload();
                });
              }
            }
          },
          {
            greetings: welcomeMessage,
            keydown: function (e) {
              if (e.ctrlKey) {
                e.preventDefault();
                switch (e.which) {
                  case 72: // Ctrl + H
                    this.echo(welcomeMessage);
                    return false;
                  case 75: // Ctrl + K
                    this.echo(keymap);
                    return false;
                }
                if (e.shiftKey) {
                  switch (e.which) {
                    case 70: // Ctrl + Shift + F
                      switchFont();
                      return false;
                    case 84: // Ctrl + Shift + T
                      switchTheme();
                      return false;
                  }
                }
              }
            },
            prompt: "Î»> ",
          }
        );
      });
    </script>
  </body>
</html>
